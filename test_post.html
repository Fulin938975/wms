<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Component Templates</title>
    <style>
        /* 您可以在這裡添加一些基本的樣式 */
        .component {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- 領料模板元件 -->
    <template id="component-templateP1">
        <div class="component">
            <label for="item">領料品項：</label>
            <select class="item" name="item"></select><br>

            <label for="quantity">領料數量：</label>
            <input type="number" class="quantity" name="quantity" value="0" min="0.001" step="0.001"><br>

            <label for="weight">領料重量(公斤)：</label>
            <input type="number" class="weight" name="weight" value="0" min="0.001" step="0.001"><br>
        </div>
    </template>

    <!-- 生產模板元件 -->
    <template id="component-templateG1">
        <div class="component">
            <label for="item">生產品項：</label>
            <select class="item" name="item"></select><br>

            <label for="quantity">生產數量：</label>
            <input type="number" class="quantity" name="quantity" value="1" min="0.01" step="0.01"><br>

            <label for="weight">生產重量(公斤)：</label>
            <input type="number" class="weight" name="weight" value="1" min="0.001" step="0.001"><br>
        </div>
    </template>

    <template id="component-templateG2">
        <div class="component">
            <label for="item">生產品項：</label>
            <select class="item" name="item"></select><br>

            <label for="quantity">生產數量：</label>
            <input type="number" class="quantity" name="quantity" value="1" min="0.01" step="0.01"><br>

            <label for="weight">生產重量(公斤)：</label>
            <input type="number" class="weight" name="weight" value="1" min="0.001" step="0.001"><br>
        </div>
    </template>

    <div id="components-container"></div>

    <script>
        // 假設這些變數在某處已經定義
        const itemWeightsP1 = { 招牌細P: 4.2, 原鬆P: 4.2, 特鬆P: 4.2, 營業P: 4.2, 粗鬆P: 4.2, 全純P: 4.2 };
        const itemWeightsP2 = { 招牌細K: 4.2, 原鬆K: 4.2, 海鬆K: 4.2, 特鬆K: 4.2, 粗海K: 4.2, 營業K: 4.2, 營業海K: 4.2, 粗鬆K: 4.2, 全純K: 4.2 };
        const itemWeightsG1 = { 招牌細K: 1, 原鬆K: 1, 海鬆K: 1, 特鬆K: 1, 粗海K: 1, 營業K: 1, 營業海K: 1, 粗鬆K: 1, 全純K: 1 };
        const itemWeightsG2 = { 招牌細L: 1, 原鬆L: 1, 海鬆L: 1, 特鬆L: 1, 粗海L: 1, 營業L: 1, 營業海L: 1, 粗鬆L: 1, 全純L: 1 };

        // 定義 populateSelect 函數
        function populateSelect(selectElement, items) {
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                selectElement.appendChild(option);
            });
        }

        // 定義 addComponent 函數
        function addComponent(templateId, weights) {
            const template = document.getElementById(templateId);
            if (!template) {
                console.error(`${templateId} 模板未找到`);
                return;
            }
            const container = document.getElementById('components-container');
            const clone = document.importNode(template.content, true);
            const component = clone.querySelector('.component');

            const itemSelect = component.querySelector('.item');
            const quantityInput = component.querySelector('.quantity');
            const weightInput = component.querySelector('.weight');

            const items = Object.keys(weights);

            populateSelect(itemSelect, items);

            itemSelect.addEventListener('change', function() {
                quantityInput.value = 1;
                updateWeight(component, weights);
            });

            quantityInput.addEventListener('input', function() {
                updateWeight(component, weights);
            });

            weightInput.addEventListener('input', function() {
                updateQuantity(component, weights);
            });

            container.appendChild(clone);

            // 初始化
            updateWeight(component, weights);
        }

        // 定義 updateWeight 和 updateQuantity 函數
        function updateWeight(component, weights) {
            const itemSelect = component.querySelector('.item');
            const quantityInput = component.querySelector('.quantity');
            const weightInput = component.querySelector('.weight');

            const selectedItem = itemSelect.value;
            const quantity = parseFloat(quantityInput.value);

            if (weights[selectedItem] !== undefined) {
                weightInput.value = (weights[selectedItem] * quantity).toFixed(3);
            }
        }

        function updateQuantity(component, weights) {
            const itemSelect = component.querySelector('.item');
            const quantityInput = component.querySelector('.quantity');
            const weightInput = component.querySelector('.weight');

            const selectedItem = itemSelect.value;
            const weight = parseFloat(weightInput.value);

            if (weights[selectedItem] !== undefined) {
                quantityInput.value = (weight / weights[selectedItem]).toFixed(3);
            }
        }

        // 添加元件的函數
        function addComponentP1() {
            addComponent('component-templateP1', itemWeightsP1);
        }

        function addComponentP2() {
            addComponent('component-templateP2', itemWeightsP2);
        }

        function addComponentG1() {
            addComponent('component-templateG1', itemWeightsG1);
        }

        function addComponentG2() {
            addComponent('component-templateG2', itemWeightsG2);
        }

        // 您可以在這裡調用 addComponent 函數來添加元件
        // 例如：
        // addComponentP1();
        // addComponentP2();
        // addComponentG1();
        // addComponentG2();
    </script>
</body>
</html>